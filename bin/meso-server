#!/usr/bin/python
import argparse
import os
import subprocess as sp
import sys
from mesoimg.osutils import *
from mesoimg.app import *
from mesoimg.server import MesoServer


# Make sure we don't already have a server running.
def find_existing():

    preexisting = find_from_procinfo('server')
    if preexisting:
        msg  = "An instance of MesoServer is already running "
        msg += f"with pid {preexisting.pid}."
        logging.critical(msg)
        raise RuntimeError(msg)


def start_server():

    # Make sure we don't already have a server running.
    proc = find_from_procinfo('server')
    if proc:
        msg  = "An instance of MesoServer is already running "
        msg += f"with pid {proc.pid}."
        print(msg)
        sys.exit(-1)


    server = MesoServer()
    server_thread = Thread(target=server.run)
    server_thread.start()



print('meso-server')
print(f'argv: {sys.argv}')

